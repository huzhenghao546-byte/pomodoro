<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>æˆé•¿ç•ªèŒ„ç³»ç»Ÿ</title>
<style>
body {
    font-family: -apple-system;
    text-align: center;
    background: #111;
    color: white;
}
button {
    padding: 15px;
    margin: 8px;
    font-size: 16px;
    border-radius: 12px;
    border: none;
    width: 80%;
}
.timer-btn { background: #ff4757; }
.reward-btn { background: #1e90ff; }
.reset-btn { background: #57606f; }
h1 { margin-top: 30px; }
</style>
</head>
<body>

<h1>ğŸ… æˆé•¿ç•ªèŒ„ç³»ç»Ÿ</h1>

<h2>ç­‰çº§: <span id="level">1</span></h2>
<h2>ç§¯åˆ†: <span id="points">0</span></h2>
<h2>è¿ç»­å¤©æ•°: <span id="streak">0</span></h2>
<h2>å€’è®¡æ—¶: <span id="time">00:00</span></h2>

<button class="timer-btn" onclick="startTimer(15,10)">15åˆ†é’Ÿ +10åˆ†</button>
<button class="timer-btn" onclick="startTimer(30,25)">30åˆ†é’Ÿ +25åˆ†</button>
<button class="timer-btn" onclick="startTimer(45,45)">45åˆ†é’Ÿ +45åˆ†</button>

<br>

<button onclick="failSession()">ä¸­é€”é€€å‡º</button>
<button class="reward-btn" onclick="claimReward()">å…‘æ¢å¥–åŠ±(200åˆ†)</button>
<button class="reset-btn" onclick="resetAll()">é‡ç½®</button>

<script>

let totalPoints = parseInt(localStorage.getItem("points")) || 0;
let level = parseInt(localStorage.getItem("level")) || 1;
let streak = parseInt(localStorage.getItem("streak")) || 0;
let lastDate = localStorage.getItem("lastDate") || "";
let timer;
let currentReward = 0;
let remainingTime = 0;

function saveData() {
    localStorage.setItem("points", totalPoints);
    localStorage.setItem("level", level);
    localStorage.setItem("streak", streak);
    localStorage.setItem("lastDate", lastDate);
}

function updateUI() {
    document.getElementById("points").innerText = totalPoints;
    document.getElementById("level").innerText = level;
    document.getElementById("streak").innerText = streak;
}

function calculateLevel() {
    level = Math.floor(Math.sqrt(totalPoints / 100)) + 1;
}

function updateStreak() {
    let today = new Date().toDateString();
    if (lastDate !== today) {
        if (lastDate === new Date(Date.now() - 86400000).toDateString()) {
            streak++;
        } else {
            streak = 1;
        }
        lastDate = today;
    }
}

function startTimer(minutes, reward) {
    if (timer) return;

    currentReward = reward;
    remainingTime = minutes * 60;

    timer = setInterval(() => {
        remainingTime--;
        let m = Math.floor(remainingTime / 60);
        let s = remainingTime % 60;
        document.getElementById("time").innerText =
            String(m).padStart(2, '0') + ":" + String(s).padStart(2, '0');

        if (remainingTime <= 0) {
            clearInterval(timer);
            timer = null;
            totalPoints += currentReward;
            updateStreak();
            calculateLevel();
            saveData();
            updateUI();
            alert("å®Œæˆï¼è·å¾— " + currentReward + " ç§¯åˆ†ï¼");
        }
    }, 1000);
}

function failSession() {
    if (!timer) return;
    clearInterval(timer);
    timer = null;

    if (currentReward == 25) totalPoints -= 5;
    if (currentReward == 45) totalPoints -= 10;

    if (totalPoints < 0) totalPoints = 0;

    calculateLevel();
    saveData();
    updateUI();
    alert("ä¸­é€”é€€å‡ºï¼Œæ‰£åˆ†ï¼");
}

function claimReward() {
    if (totalPoints >= 200) {
        totalPoints -= 200;
        calculateLevel();
        saveData();
        updateUI();
        alert("å¥–åŠ±å…‘æ¢æˆåŠŸï¼");
    } else {
        alert("ç§¯åˆ†ä¸è¶³ï¼");
    }
}

function resetAll() {
    localStorage.clear();
    location.reload();
}

updateUI();

</script>

</body>
</html>
